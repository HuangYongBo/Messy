

#include <select.c>
#define GOODIX_MAX_CFG_GROUP    6
#define GTP_REG_SENSOR_ID   0x814A
unsigned char cfg_group4_data[] = {
0x00 ,0x00 ,0x04 ,0x20 ,0x03 ,0x05 ,0x02 /*低电平触发*/,0x00 ,0x02 ,0x0B ,
0x14 ,0x0F ,0x64 ,0x50 ,0x03 ,0x05 ,0x00 ,0x00 ,0x00 ,0x00 ,
0x00 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x8B ,0x2B ,0x0D ,
0x3C ,0x36 ,0x05 ,0x0D ,0x00 ,0x00 ,0x00 ,0x00 ,0x03 ,0x2D ,
0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x03 ,0x64 ,0x32 ,0x00 ,0x00 ,
0x00 ,0x5A ,0x96 ,0x94 ,0xC5 ,0x02 ,0x08 ,0x00 ,0x00 ,0x05 ,
0x0D ,0x38 ,0xC1 ,0x0F ,0x34 ,0x89 ,0x10 ,0x36 ,0x51 ,0x11 ,
0x3A ,0x19 ,0x12 ,0x3D ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,
0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,
0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,
0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,
0x00 ,0x00 ,0x02 ,0x04 ,0x06 ,0x08 ,0x0A ,0x0C ,0x0E ,0x10 ,
0x12 ,0x14 ,0x16 ,0x18 ,0x1A ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,
0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,
0xFF ,0xFF ,0x00 ,0x02 ,0x04 ,0x06 ,0x08 ,0x0A ,0x0C ,0x0F ,
0x10 ,0x12 ,0x13 ,0x16 ,0x18 ,0x1C ,0x1D ,0x1E ,0x1F ,0x20 ,
0x21 ,0x22 ,0x24 ,0x26 ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,
0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,0xFF ,
0xFF ,0xFF ,0xFF ,0xFF ,0xD0 ,0x01
};

int touch_send_cfg(char *buf)
{
	int ret;
	int retry = 0;
	
	for(retry;retry < 3;retry ++)
	{
		ret = i2c_write(0x5D,0x8047,2,buf,186);
		if(ret == 0)
			break;
		printf("[%s] retry time:%d\r\n",__func__,retry); 
	}

	medlay(10);

	return ret;

}
	
int touch_init()
{
	int ret;
	int i;
	int check_sum = 0;
	char opr_buf[16];
	char sensor_id = 0;

	ret = gtp_i2c_read_dbl_check(0x41E4,opr_buf,1);
	if(SUCCESS == ret)
	{
		if(opr_buf[0] != 0xBE)
		{
			printf("[touch_init] error :no config sent \r\n");
			return -1;
		}
	}	

	ret = gtp_i2c_read_dbl_check(GTP_REG_SENSOR_ID,&sensor_id,1);	
	if(SUCCESS == ret)
	{
		if(sensor_id >= GOODIX_MAX_CFG_GROUP)
		{
			printf("[touch_init] error: Invalid sensor_id(0x%02X),no config sent\r\n",sensor_id);
			return -1;
		}

	}else
	{
		printf("[touch_init] error: Failed to get sensor_id,no config sent\r\n");
		return -1;
	}
	printf("[touch_init] Sensor ID selectd: %d\r\n",sensor_id);

/*
	ret = gtp_i2c_read_dbl_check(GTP_REG_CONFIG_DATA,&opr_buf[0],1)
	if(ret == SUCCESS)
	{
		if(opr_buf[0] < 90)
		{

		}

	}
*/
	for(i = 0;i < 184; i++)
	{
		check_sum += cfg_group4_data[i];
	}
	cfg_group4_data[184] = (~check_sum) + 1;
	
	ret = touch_send_cfg(cfg_group4_data);
	if(ret < 0)
		printf("%s : send config error\r\n",__func__);
	return ret ;
}
